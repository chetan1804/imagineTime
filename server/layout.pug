doctype
<!--[if lt IE 7]><html class="no-js lt-ie10 lt-ie9 lt-ie8 lt-ie7" > <![endif]-->
<!--[if IE 7]><html class="no-js lt-ie10 lt-ie9 lt-ie8" > <![endif]-->
<!--[if IE 8]><html class="no-js lt-ie10 lt-ie9" > <![endif]-->
<!--[if IE 9]><html class="no-js lt-ie10" > <![endif]-->
<!--[if IE 10]><html class="no-js lt-ie11" > <![endif]-->
<!--[if gt IE 8]> <html class="no-js" lang="en" > <![endif]-->
html(lang="en")
  head
    
    //- title should match project name by default
    title=title
    meta(name="description" content="Your Practice Made Perfect")
    meta(name="viewport", content="width=device-width, initial-scale=1.0, shrink-to-fit=no, minimum-scale=1.00, maximum-scale=2.50")
    meta(charset="utf-8")
    meta(HTTP-EQUIV="Content-type" CONTENT="text/html; charset=UTF-8")
    link(href=titleIcon, rel="shortcut icon", type="image/x-icon")
    link(href='https://fonts.googleapis.com/css?family=Source+Code+Pro:400,300,700,200,600,500,900' rel='stylesheet' type='text/css')
    link(rel="stylesheet", href="/css/animate.min.css")

    //~ load the service force css
    if (staff)
      link(rel="stylesheet", href="/css/salesforcechat.css")
      if (isLexshare)
        link(rel="stylesheet", href="/css/lexshare_salesforcechat.css")
      else
        link(rel="stylesheet", href="/css/mangoshare_salesforcechat.css")

    //- shims for (hopefully) better cross browser support
    script(src='https://cdnjs.cloudflare.com/ajax/libs/es5-shim/4.5.7/es5-shim.min.js')
    script(src='https://cdnjs.cloudflare.com/ajax/libs/json3/3.3.2/json3.min.js')
    script(src='https://cdnjs.cloudflare.com/ajax/libs/es6-shim/0.34.2/es6-shim.min.js')
    script(src='https://cdnjs.cloudflare.com/ajax/libs/html5shiv/3.7.3/html5shiv.min.js')
    script(src='https://cdnjs.cloudflare.com/ajax/libs/babel-polyfill/7.6.0/polyfill.min.js')

    //- include matchMedia polyfills for ie8-9 support
    script(src='/lib/matchMedia.js')
    script(src='/lib/matchMedia.addListener.js')

    //- socket.io client library
    script(src='https://cdnjs.cloudflare.com/ajax/libs/socket.io/2.1.1/socket.io.js')

    //- icons NOTE: using fontawesome pro
    //- link(rel="stylesheet" href="https://pro.fontawesome.com/releases/v5.8.1/css/all.css" integrity="sha384-Bx4pytHkyTDy3aJKjGkGoHPt3tvv6zlwwjc3iqN7ktaiEMLDPqLSZYts2OjKcBx1" crossorigin="anonymous")
    //script(src="https://kit.fontawesome.com/c5bfbf91b2.js")
    script(src="https://kit.fontawesome.com/752d0a57d8.js", crossorigin="anonymous")

    //- bulk download
    script(src='https://cdnjs.cloudflare.com/ajax/libs/jszip/3.2.1/jszip.min.js')
    script(src='https://cdnjs.cloudflare.com/ajax/libs/jszip-utils/0.1.0/jszip-utils.js')
    

    //- stax js
    //-script(src='https://fattjs.fattpay.com/js/fattmerchant.js?id=nocache2', async)
    
    //- compiled SASS styles
    link(rel="stylesheet", href="/css/yote.css")

    //- regular non-SASS styles
    //- uncomment line below to use
    //- link(rel="stylesheet", href="/css/style.css")

    //- set current user if it exists. else set to null.
    if !!currentUser
      script.
        window.currentUser = !{JSON.stringify(currentUser)}
    else
      script.
        window.currentUser = {}
    script.
      window.development = !{JSON.stringify(development)}

    script.
      window.appUrl = !{JSON.stringify(appUrl)}

      //- experimental socket idea.
    script.
      window.socket = io()

    //- <!-- Google Analytics -->
    //script.
        //- uncomment if you want to integrate Google Analytics (along with app.js.jsx)
        //- (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
        //- (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
        //- m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
        //- })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
        //- ga('create', 'UA-CHANGE-ME', 'auto');
        //- //don't want to double up the first page view
        //- //- ga('send', 'pageview');
    //- <!-- End Google Analytics -->
    
    // Loading Biscuit css
    style.
      div.loadingBiscuit {display: flex; min-width: 80px; max-width: 80vw; text-align: center; border-radius: 0px; padding: 10px; position: fixed; _position: fixed; /* IE6 */ z-index: 1001; background-color: #878787; color: #FFFFFF; font-size: 20px; left: 50%; bottom: 1px; transform: translate(-50%); }
      div.loadingBiscuit div.content { padding: 0px 5px 0px 5px; text-align: left; }
      div.loadingBiscuit div.spinnerIconBox { padding: 1px 5px; }

  body
    //- load the react container and run the react script
    #application-main-yote(class=className)

      //- Loading biscuit for the time the screen is loaded the first time
      div.loadingBiscuit
        div.fas.fa-spinner.fa-spin.spinnerIconBox
        div.content Loading...

    each script in scripts
      script(src=script)
      
    if staff
      //- script(src='/lib/interCom.js')
      //- script.
      //-   window.intercomSettings = {
      //-     app_id: "ygr5wwhj"
      //-     , name: `${currentUser.firstname} ${currentUser.lastname}`
      //-     , email: currentUser.username
      //-     , created_at: parseInt((new Date().getTime() / 1000).toFixed(0))
      //-   }
      //- script(src='https://js.intercomcdn.com/shim.latest.js')

      script(type='text/javascript', src='https://service.force.com/embeddedservice/5.0/esw.min.js')
      if isLexshare
        script(type='text/javascript').
          var initESW = function(gslbBaseURL) {
            embedded_svc.settings.displayHelpButton = true
            embedded_svc.settings.language = 'en-US'

            embedded_svc.settings.defaultMinimizedText = 'Chat with Us'; 

            embedded_svc.settings.enabledFeatures = ['LiveAgent']
            embedded_svc.settings.entryFeature = 'LiveAgent'

            embedded_svc.settings.prepopulatedPrechatFields = {
              'FirstName': "#{user.firstname}",
              'LastName': "#{user.lastname}",
              'Email': "#{user.username}",
              'Company_Name__c': "#{firm.name}"
            };
            // demo lexshare
            //- embedded_svc.init(
            //-   'https://profitsolv1--psfullsb.sandbox.my.salesforce.com',
            //-   'https://profitsolv1--psfullsb.sandbox.my.salesforce-sites.com/liveAgentSetupFlow',
            //-   gslbBaseURL,
            //-   '00DDH0000005kIc',
            //-   'LexShare_Live_Chat',
            //-   {
            //-     baseLiveAgentContentURL: 'https://c.la1-c1cs-ia6.salesforceliveagent.com/content',
            //-     deploymentId: '572DH000000Cdfw',
            //-     buttonId: '573DH000000Ce0N',
            //-     baseLiveAgentURL: 'https://d.la1-c1cs-ia6.salesforceliveagent.com/chat',
            //-     eswLiveAgentDevName: 'EmbeddedServiceLiveAgent_Parent04IDH000000Cayk2AC_18966840b46',
            //-     isOfflineSupportEnabled: true
            //-   }
            //- );

            // production lexshare
            embedded_svc.init(
              'https://profitsolv1.my.salesforce.com',
              'https://profitsolv1.my.salesforce-sites.com/liveAgentSetupFlow',
              gslbBaseURL,
              '00D5f000005uUOr',
              'LexShare_Live_Chat',
              {
                baseLiveAgentContentURL: 'https://c.la4-c1-ia5.salesforceliveagent.com/content',
                deploymentId: '5725f000000Uhqz',
                buttonId: '5735f000000UiR3',
                baseLiveAgentURL: 'https://d.la4-c1-ia5.salesforceliveagent.com/chat',
                eswLiveAgentDevName: 'EmbeddedServiceLiveAgent_Parent04IDH000000Cayk2AC_18966840b46',
                isOfflineSupportEnabled: true
              }
            );
          }

          if (!window.embedded_svc) {
            var s = document.createElement('script')
            s.setAttribute('src', 'https://profitsolv1--psfullsb.sandbox.my.salesforce.com/embeddedservice/5.0/esw.min.js')
            s.onload = function() {
              initESW(null)
            }
            document.body.appendChild(s);
          } else {
            initESW('https://service.force.com')
          }
      else
        script(type='text/javascript').
          var initESW = function(gslbBaseURL) {
            embedded_svc.settings.displayHelpButton = true
            embedded_svc.settings.language = 'en-US'

            embedded_svc.settings.defaultMinimizedText = 'Chat with Us'; 

            embedded_svc.settings.enabledFeatures = ['LiveAgent']
            embedded_svc.settings.entryFeature = 'LiveAgent'

            embedded_svc.settings.prepopulatedPrechatFields = {
              'FirstName': "#{user.firstname}",
              'LastName': "#{user.lastname}",
              'Email': "#{user.username}",
              'Company_Name__c': "#{firm.name}"
            };

            // demo mangoshare
            //- embedded_svc.init(
            //-   'https://profitsolv1--psfullsb.sandbox.my.salesforce.com',
            //-   'https://profitsolv1--psfullsb.sandbox.my.salesforce-sites.com/liveAgentSetupFlow',
            //-   gslbBaseURL,
            //-   '00DDH0000005kIc',
            //-   'MangoShare_Live_Chat',
            //-     {
            //-       baseLiveAgentContentURL: 'https://c.la1-c1cs-ia6.salesforceliveagent.com/content',
            //-       deploymentId: '572DH000000Cdfw',
            //-       buttonId: '573DH000000Cf9r',
            //-       baseLiveAgentURL: 'https://d.la1-c1cs-ia6.salesforceliveagent.com/chat',
            //-       eswLiveAgentDevName: 'EmbeddedServiceLiveAgent_Parent04IDH000000Cayf2AC_1896677bd4d',
            //-       isOfflineSupportEnabled: true
            //-     }
            //- );

            // production mangoshare
            embedded_svc.init(
              'https://profitsolv1.my.salesforce.com',
              'https://profitsolv1.my.salesforce-sites.com/liveAgentSetupFlow',
              gslbBaseURL,
              '00D5f000005uUOr',
              'MangoShare_Live_Chat',
              {
                baseLiveAgentContentURL: 'https://c.la4-c1-ia5.salesforceliveagent.com/content',
                deploymentId: '5725f000000Uhqz',
                buttonId: '5735f000000UiR8',
                baseLiveAgentURL: 'https://d.la4-c1-ia5.salesforceliveagent.com/chat',
                eswLiveAgentDevName: 'EmbeddedServiceLiveAgent_Parent04IDH000000Cayf2AC_1896677bd4d',
                isOfflineSupportEnabled: true
              }
            );
          }

          if (!window.embedded_svc) {
            var s = document.createElement('script')
            s.setAttribute('src', 'https://profitsolv1--psfullsb.sandbox.my.salesforce.com/embeddedservice/5.0/esw.min.js')
            s.onload = function() {
              initESW(null)
            }
            document.body.appendChild(s);
          } else {
            initESW('https://service.force.com')
          }